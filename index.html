<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>My Travel Pro - Customized</title>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    
    <style>
        :root { 
            --mocha: #bda38f; 
            --latte: #e8e2d6; 
            --dark-text: #433422; 
        }

        /* 1. èƒŒæ™¯åœ–ç‰‡è¨­å®šï¼šå¥—ç”¨ä½ ä¸Šå‚³çš„æ—…è¡Œæ’ç•« */
        body { 
            background-image: url('https://files.oaiusercontent.com/file-f38c67'); /* æ›¿æ›ç‚ºä½ çš„åœ–ç‰‡ URL */
            background-size: cover;
            background-attachment: fixed;
            background-position: center;
            color: var(--dark-text); 
            font-family: -apple-system, sans-serif; 
            margin: 0; padding: 0; 
        }

        [v-cloak] { display: none; }

        /* 2. æ¯›ç»ç’ƒå¡ç‰‡æ•ˆæœï¼šè®“æ–‡å­—åœ¨èƒŒæ™¯åœ–ä¸Šä¾ç„¶æ¸…æ™° */
        .card-muji { 
            background: rgba(255, 255, 255, 0.8); 
            backdrop-filter: blur(10px); 
            border-radius: 24px; 
            box-shadow: 0 8px 32px rgba(0,0,0,0.05); 
            border: 1px solid rgba(255, 255, 255, 0.3);
        }

        /* 3. è¡Œç¨‹å€å¡Šå·¦å³é…ç½®ï¼šå·¦å´æ™‚é–“å¼·åŒ– */
        .time-focus { font-size: 1.8rem; font-weight: 900; line-height: 1; letter-spacing: -1px; }
        .timeline-line { position: absolute; left: 52px; top: 0; bottom: 0; width: 1px; background: rgba(67, 52, 34, 0.1); z-index: 0; }

        .input-underlined { background: transparent; border-bottom: 1px solid rgba(0,0,0,0.05); outline: none; width: 100%; padding: 4px 0; font-size: 14px; }
        
        /* 4. è‡ªå®šç¾©å‹¾é¸æ¡†ï¼ˆäººæ€§åŒ–æ‰‹æ©Ÿé¢¨æ ¼ï¼‰ */
        .checkbox-custom { width: 24px; height: 24px; border: 2px solid var(--mocha); border-radius: 8px; flex-shrink: 0; transition: all 0.2s; }
        .checkbox-custom.checked { background: var(--mocha); border-color: var(--mocha); color: white; display: flex; align-items: center; justify-content: center; }

        #map { height: 350px; border-radius: 24px; border: 6px solid white; width: 100%; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
    </style>
</head>
<body>
    <div id="app" v-cloak>
        
        <div v-if="!isSetup" class="fixed inset-0 z-[100] flex items-center justify-center px-8 bg-white/20 backdrop-blur-md">
            <div class="card-muji w-full max-w-sm p-10 space-y-6 text-center">
                <h1 class="text-3xl font-black">Ready to Go?</h1>
                <input v-model="setup.destination" placeholder="ç›®çš„åœ° (ä¾‹å¦‚ï¼šå¤§é˜ª)" class="w-full p-4 rounded-xl border-none shadow-inner text-center">
                <div class="grid grid-cols-2 gap-3">
                    <input type="date" v-model="setup.startDate" class="p-2 rounded-lg text-xs">
                    <input type="date" v-model="setup.endDate" class="p-2 rounded-lg text-xs">
                </div>
                <button @click="finishSetup" class="w-full py-4 bg-[#333] text-white rounded-2xl font-bold shadow-lg">START JOURNEY</button>
            </div>
        </div>

        <div v-else class="max-w-md mx-auto min-h-screen pb-10">
            
            <div class="px-6 pt-8">
                <div class="card-muji p-6 flex justify-between items-center bg-[#333]/90 text-white border-none">
                    <div>
                        <h2 class="text-2xl font-bold">{{ formattedDate }}</h2>
                        <p class="text-xs opacity-60">ğŸ“ {{ setup.destination }}</p>
                    </div>
                    <div class="text-right">
                        <div class="text-3xl font-black">{{ weatherIcon }} {{ weather.temp }}Â°C</div>
                        <p class="text-[10px] font-bold opacity-60 uppercase">{{ weather.desc }}</p>
                    </div>
                </div>
            </div>

            <div class="flex overflow-x-auto px-6 space-x-3 no-scrollbar my-6">
                <div v-for="d in totalDays" :key="d" @click="selectedDay = d"
                     :class="['flex-shrink-0 px-6 h-12 flex items-center justify-center rounded-2xl font-bold transition-all', 
                     selectedDay === d ? 'bg-[#333] text-white shadow-xl scale-105' : 'card-muji text-gray-500']">
                    Day {{ d }}
                </div>
            </div>

            <main class="px-6 space-y-8">
                <nav class="flex space-x-6 text-sm font-bold border-b border-black/5 pb-2">
                    <button @click="tab = 'list'" :class="tab === 'list' ? 'border-b-2 border-[#333]' : 'opacity-30'">è¡Œç¨‹</button>
                    <button @click="tab = 'map'; updateMapMarkers()" :class="tab === 'map' ? 'border-b-2 border-[#333]' : 'opacity-30'">åœ°åœ–</button>
                    <button @click="tab = 'items'" :class="tab === 'items' ? 'border-b-2 border-[#333]' : 'opacity-30'">å¿…å‚™ç”¨å“</button>
                    <button @click="tab = 'finance'" :class="tab === 'finance' ? 'border-b-2 border-[#333]' : 'opacity-30'">åˆ†å¸³</button>
                </nav>

                <div v-if="tab === 'list'" class="space-y-10 relative">
                    <div class="timeline-line"></div>
                    <div v-for="(p, i) in currentPlans" :key="i" class="relative flex items-start space-x-4">
                        
                        <div class="w-24 flex-shrink-0 flex flex-col items-center">
                            <div class="card-muji w-full py-3 text-center shadow-sm">
                                <button @click="p.ampm = p.ampm === 'ä¸Šåˆ' ? 'ä¸‹åˆ' : 'ä¸Šåˆ'" class="text-[9px] font-black opacity-50">{{ p.ampm }}</button>
                                <div class="time-focus text-[#333]">{{ p.time.split(':')[0] }}<span class="text-lg opacity-30">:{{ p.time.split(':')[1] }}</span></div>
                                <div class="text-[10px] mt-1">â° ALARM</div>
                            </div>
                            <select v-model="p.time" class="mt-2 text-[10px] bg-white/50 rounded-lg p-1 outline-none">
                                <option v-for="t in timeSlots" :key="t" :value="t">{{ t }}</option>
                            </select>
                        </div>

                        <div class="card-muji flex-grow p-5 space-y-3">
                            <input v-model="p.loc" placeholder="è¡Œç¨‹æ¨™é¡Œ (ä¾‹å¦‚ï¼šç¯‰åœ°å¸‚å ´)" class="text-lg font-black bg-transparent outline-none w-full border-b border-black/5 pb-1">
                            
                            <div class="space-y-2">
                                <div class="flex items-center text-xs text-gray-500">
                                    <span class="mr-2">ğŸ“</span>
                                    <input v-model="p.mapLink" placeholder="æ™¯é»åœ°å€..." class="input-underlined">
                                </div>
                                <div class="flex items-center text-xs text-gray-500">
                                    <span class="mr-2">ğŸ´</span>
                                    <input v-model="p.eat" placeholder="é£²é£Ÿå®‰æ’..." class="input-underlined">
                                </div>
                                <div class="flex items-start text-xs text-gray-400">
                                    <span class="mr-2 mt-1">ğŸ“</span>
                                    <textarea v-model="p.note" placeholder="è©³ç´°å‚™è¨»èˆ‡ç­†è¨˜..." class="w-full bg-transparent border-none outline-none h-12 resize-none"></textarea>
                                </div>
                            </div>
                        </div>
                    </div>
                    <button @click="addPlan" class="w-full py-5 rounded-2xl border-2 border-dashed border-gray-300 text-xs font-bold opacity-50">+ æ–°å¢è¡Œç¨‹</button>
                </div>

                <div v-if="tab === 'items'" class="card-muji p-6 space-y-6">
                    <div class="flex items-center justify-between">
                        <h3 class="font-bold">æ—…è¡Œæ¸…å–®</h3>
                        <div class="flex space-x-2">
                            <input v-model="customItem" placeholder="è‡ªå®šç¾©é …ç›®..." class="text-xs p-2 rounded-lg bg-gray-100 outline-none">
                            <button @click="addCustomItem" class="px-3 py-1 bg-[#333] text-white text-xs rounded-lg font-bold">æ–°å¢</button>
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-1 gap-3">
                        <div v-for="(item, idx) in checklist" :key="idx" 
                             class="flex items-center justify-between p-3 rounded-xl bg-white/40 border border-white/50"
                             @click="item.done = !item.done">
                            <div class="flex items-center space-x-3">
                                <div :class="['checkbox-custom', { 'checked': item.done }]">
                                    <span v-if="item.done" class="text-xs">âœ“</span>
                                </div>
                                <span :class="['text-sm font-medium', { 'line-through opacity-30': item.done }]">{{ item.name }}</span>
                            </div>
                            <button @click.stop="checklist.splice(idx, 1)" class="opacity-20 text-xs italic">åˆªé™¤</button>
                        </div>
                    </div>
                </div>

                <div v-show="tab === 'map'" class="space-y-4"><div id="map"></div></div>

                <div v-if="tab === 'finance'" class="card-muji p-8 space-y-6">
                    <input type="number" v-model="finance.amount" placeholder="å¤–å¹£é‡‘é¡" class="w-full p-4 rounded-xl text-2xl font-black text-center outline-none bg-gray-50 shadow-inner">
                    <div class="grid grid-cols-2 gap-4">
                        <div class="bg-white/50 p-3 rounded-xl">
                            <label class="text-[10px] opacity-40 uppercase block">åŒ¯ç‡</label>
                            <input type="number" v-model="finance.rate" class="w-full bg-transparent font-bold">
                        </div>
                        <div class="bg-white/50 p-3 rounded-xl">
                            <label class="text-[10px] opacity-40 uppercase block">ä»˜æ¬¾äºº</label>
                            <input v-model="finance.payer" class="w-full bg-transparent font-bold">
                        </div>
                    </div>
                    <input v-model="finance.receiver" placeholder="åˆ†æ”¤æ—…ä¼´ (ä¾‹å¦‚: A, B, C)" class="w-full p-4 rounded-xl text-sm bg-white/50 outline-none">
                    <div class="bg-[#333] p-10 rounded-[32px] text-white text-center shadow-xl">
                        <p class="text-[10px] opacity-40 mb-2">AUTO CALCULATE</p>
                        <p v-if="splitInfo" class="text-xl font-medium italic text-[#bda38f]">{{ splitInfo }}</p>
                        <p v-else class="text-sm opacity-20">è«‹è¼¸å…¥åˆ†æ”¤äºº</p>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <script>
        const { createApp, ref, computed, watch, onMounted } = Vue;
        createApp({
            setup() {
                const isSetup = ref(false); const tab = ref('list'); const selectedDay = ref(1);
                const setup = ref({ destination: '', startDate: '', endDate: '' });
                const weather = ref({ temp: '--', desc: 'Sunny' });
                const finance = ref({ amount: 0, rate: 0.22, payer: 'æˆ‘', receiver: '' });
                const itineraryData = ref({});
                const customItem = ref('');
                
                // é è¨­ç”¨å“æ¸…å–®ï¼Œå°‡æœƒç›´æ¥åœ¨ç•«é¢ä¸Šå‘ˆç¾
                const checklist = ref([
                    { name: "è­·ç…§/ç°½è­‰", done: false },
                    { name: "ç¶²å¡/Wifiæ©Ÿ", done: false },
                    { name: "æ—¥å¹£ç¾é‡‘", done: false },
                    { name: "æ›æ´—è¡£ç‰©", done: false },
                    { name: "è¡Œå‹•é›»æº", done: false }
                ]);

                const timeSlots = Array.from({length: 24}, (_, i) => [i.toString().padStart(2, '0') + ':00', i.toString().padStart(2, '0') + ':30']).flat();

                onMounted(() => {
                    const saved = localStorage.getItem('myTripData_v2');
                    if (saved) {
                        const parsed = JSON.parse(saved);
                        itineraryData.value = parsed.itinerary || {};
                        setup.value = parsed.setup || setup.value;
                        checklist.value = parsed.checklist || checklist.value;
                        if (setup.value.destination) isSetup.value = true;
                    }
                });

                watch([itineraryData, setup, checklist], () => {
                    localStorage.setItem('myTripData_v2', JSON.stringify({ itinerary: itineraryData.value, setup: setup.value, checklist: checklist.value }));
                }, { deep: true });

                const weatherIcon = computed(() => {
                    const d = weather.value.desc.toLowerCase();
                    if (d.includes('sun')) return 'â˜€ï¸'; if (d.includes('cloud')) return 'â˜ï¸'; if (d.includes('rain')) return 'ğŸŒ§ï¸';
                    return 'ğŸŒ¤ï¸';
                });

                const splitInfo = computed(() => {
                    if (!finance.value.amount || !finance.value.receiver) return "";
                    const totalTWD = Math.round(finance.value.amount * finance.value.rate);
                    const people = finance.value.receiver.split(',').filter(n => n.trim() !== "");
                    if (people.length === 0) return "";
                    return `${people.join(', ')} æ‡‰çµ¦ ${finance.value.payer} NT$ ${Math.round(totalTWD / (people.length + 1))}`;
                });

                const addCustomItem = () => {
                    if (customItem.value.trim()) {
                        checklist.value.push({ name: customItem.value, done: false });
                        customItem.value = '';
                    }
                };

                const totalDays = computed(() => {
                    if (!setup.value.startDate || !setup.value.endDate) return 1;
                    return Math.max(1, Math.ceil(Math.abs(new Date(setup.value.endDate) - new Date(setup.value.startDate)) / 86400000) + 1);
                });

                const formattedDate = computed(() => {
                    if (!setup.value.startDate) return '';
                    const d = new Date(setup.value.startDate); d.setDate(d.getDate() + (selectedDay.value - 1));
                    return `${d.getMonth() + 1}/${d.getDate()}`;
                });

                const currentPlans = computed(() => {
                    const key = `day_${selectedDay.value}`;
                    if (!itineraryData.value[key]) itineraryData.value[key] = [];
                    return itineraryData.value[key];
                });

                const addPlan = () => currentPlans.value.push({ ampm: 'ä¸Šåˆ', time: '09:00', loc: '', mapLink: '', eat: '', note: '' });
                const finishSetup = () => { if(setup.value.destination) isSetup.value = true; };

                return { isSetup, setup, totalDays, tab, selectedDay, finance, itineraryData, currentPlans, weather, weatherIcon, formattedDate, finishSetup, addPlan, timeSlots, checklist, customItem, addCustomItem, splitInfo };
            }
        }).mount('#app');
    </script>
</body>
</html>
